<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Japan Travel</title>
    <!-- å¼•å…¥ Swiper çš„ CSS -->
    <link rel="stylesheet" href="https://unpkg.com/swiper/swiper-bundle.min.css">
    
    <!-- å¼•ç”¨æˆ‘ä»¬è‡ªå·±çš„å¤–éƒ¨æ ·å¼è¡¨ -->
    <link rel="stylesheet" href="styleForIndex.css">
</head>
<body>

    <!-- ======== å¯¼èˆªæ  ======== -->
    <header class="navbar">
        <div class="container">
            <a href="#" class="logo">åœ†å‘¨æ—…è¿¹</a>
            <div class="hamburger-menu">
                <span></span>
                <span></span>
                <span></span>
            </div>
            <nav class="nav-links">
                <a href="#hero">é¦–é¡µ</a>
                <a href="#slider-container">ç›®çš„åœ°</a>
                <a href="#my-trips">æˆ‘çš„è¡Œç¨‹</a>
                <a href="#site-footer">è”ç³»æˆ‘ä»¬</a>
            </nav>
            
            <div class="nav-auth">
                <a href="login.html" class="login" id="nav-login-btn">Log in</a>
                <div id="nav-user-info" style="display:none;">
                    <span id="nav-user-name"></span>
                    <a href="#" id="logout-btn" style="margin-left:10px;">Log out</a>
                </div>
            </div>
        </div>
    </header>

    <!-- è‹±é›„å±•ç¤ºåŒº -->
    <section id="hero" class="hero-section">
        <div class="hero-content">
            <h1>å‘ç°ä¸–ç•Œçš„ç¾ä¸½</h1>
            <p>æ¢ç´¢å…¨çƒæœ€ä»¤äººæƒŠå¹çš„ç›®çš„åœ°ï¼Œä½“éªŒç‹¬ç‰¹çš„æ–‡åŒ–ï¼Œåˆ›é€ éš¾å¿˜çš„å›å¿†ã€‚æˆ‘ä»¬ä¸ºæ‚¨æä¾›æœ€ä¼˜è´¨çš„æ—…è¡ŒæœåŠ¡ã€‚</p>
            <a href="#slider-container" class="btn-explore">å¼€å§‹æ¢ç´¢</a>
        </div>
    </section>

    <!-- ä¸»å†…å®¹åŒº -->
    <main>
        <!-- æ»‘å—å®¹å™¨ (å³ç‰¹è‰²ç›®çš„åœ°) -->
        <div id="slider-container" class="container">
            <div class="section-header-interactive">
                <h2>Featured Topics</h2>
                <div class="search-container">
                    <input type="search" id="city-search-input" placeholder="Search for a city...">
                    <button id="city-search-btn" aria-label="Search">ğŸ”</button>
                </div>
            </div>

            <div class="swiper-container">
                <div class="swiper-wrapper">
                    <!-- Slide 1: Tokyo -->
                    <div class="swiper-slide" data-city="Tokyo" data-lat="35.6895" data-lon="139.6917" data-zoom="12">
                        <img src="images/tokyo.png" alt="Tokyo">
                        <div class="slide-caption">Tokyo</div>
                    </div>
                    <!-- Slide 2: Osaka -->
                    <div class="swiper-slide" data-city="Osaka" data-lat="34.6937" data-lon="135.5023" data-zoom="12">
                        <img src="images/osaka.png" alt="Osaka">
                         <div class="slide-caption">Osaka</div>
                    </div>
                    <!-- Slide 3: Kyoto -->
                    <div class="swiper-slide" data-city="Kyoto" data-lat="35.0116" data-lon="135.7681" data-zoom="12">
                        <img src="images/kyoto.png" alt="Kyoto">
                         <div class="slide-caption">Kyoto</div>
                    </div>
                    <!-- å¤åˆ¶çš„æ»‘å— -->
                    <div class="swiper-slide" data-city="Tokyo" data-lat="35.6895" data-lon="139.6917" data-zoom="12">
                        <img src="images/tokyo.png" alt="Tokyo">
                        <div class="slide-caption">Tokyo</div>
                    </div>
                    <div class="swiper-slide" data-city="Osaka" data-lat="34.6937" data-lon="135.5023" data-zoom="12">
                        <img src="images/osaka.png" alt="Osaka">
                         <div class="slide-caption">Osaka</div>
                    </div>
                    <div class="swiper-slide" data-city="Kyoto" data-lat="35.0116" data-lon="135.7681" data-zoom="12">
                        <img src="images/kyoto.png" alt="Kyoto">
                         <div class="slide-caption">Kyoto</div>
                    </div>
                </div>
                <div class="swiper-pagination"></div>
                <div class="swiper-button-next"></div>
                <div class="swiper-button-prev"></div>
            </div>
        </div>

        <!-- æˆ‘çš„è¡Œç¨‹å±•ç¤ºåŒº -->
        <div id="my-trips" class="container">
            <div class="my-trips-header">
                <h2>My Trips</h2>
                <button id="add-trip-btn" title="Create a new trip">+</button>
            </div>
            <div id="my-trips-list">
                <!-- ç”±JavaScriptåˆ›å»ºçš„å¡ç‰‡å¼è¡Œç¨‹å°†æ’å…¥è¿™é‡Œ -->
                <p class="empty-trips-message" id="trips-empty-message">You have no trips yet. Click the '+' to add one!</p>
            </div>
        </div>
    </main>

    <!-- é¡µè„š -->
    <footer id="site-footer" class="site-footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-column about-us">
                    <h3>å…³äºæˆ‘ä»¬</h3>
                    <p>æ¢ç´¢ä¸–ç•Œæ—…è¡Œç¤¾è‡´åŠ›äºä¸ºå¯»æ±‚ç»ˆæä¼˜é€‰çš„æ—…è¡Œä½“éªŒã€è®©æ¯ä¸€æ¬¡æ—…ç¨‹éƒ½æˆä¸ºéš¾å¿˜çš„å›å¿†ã€‚</p>
                </div>
                <div class="footer-column quick-links">
                    <h3>å¿«é€Ÿé“¾æ¥</h3>
                    <ul>
                        <li><a href="#hero">é¦–é¡µ</a></li>
                        <li><a href="#slider-container">ç›®çš„åœ°</a></li>
                        <li><a href="#">æ—…è¡Œå¥—é¤</a></li>
                        <li><a href="#">æ—…è¡Œåšå®¢</a></li>
                        <li><a href="#">å¸¸è§é—®é¢˜</a></li>
                    </ul>
                </div>
                <div class="footer-column contact-us">
                    <h3>è”ç³»æˆ‘ä»¬</h3>
                    <ul>
                        <li>ç”µè¯ï¼š400-123-4567</li>
                        <li>é‚®ç®±ï¼šinfo@exploreworld.com</li>
                        <li>åœ°å€ï¼šåŒ—äº¬å¸‚æœé˜³åŒºå»ºå›½å¤§é“18å·</li>
                    </ul>
                </div>
            </div>
            <div class="footer-bottom">
                <p>Â© 2025 æ¢ç´¢ä¸–ç•Œæ—…è¡Œç¤¾. ä¿ç•™æ‰€æœ‰æƒåˆ©.</p>
            </div>
        </div>
    </footer>

    <!-- åˆ›å»ºæˆ‘çš„è¡Œç¨‹å¼¹çª— (è¿™æ˜¯å®ƒåº”è¯¥åœ¨çš„ä½ç½®) -->
    <div id="trip-modal">
        <div class="modal-content">
            <div class="modal-title">Create My Trip</div>
            <label>Where do you want to go?</label>
            <input id="trip-city" type="text" placeholder="Enter city">
            <label>How long do you want to go?</label>
            <div class="date-picker-group">
                <div class="date-picker-item">
                    <div class="date-label">Departure date</div>
                    <input id="trip-date-from" type="date">
                </div>
                <div class="date-picker-item">
                    <div class="date-label">Return date</div>
                    <input id="trip-date-to" type="date">
                </div>
            </div>
            <div class="modal-actions">
                <button id="trip-cancel">Cancel</button>
                <button id="trip-confirm">Confirm</button>
            </div>
        </div>
    </div>

    <!-- Swiper å’Œè„šæœ¬ -->
    <script src="https://unpkg.com/swiper/swiper-bundle.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            // --- å¯¼èˆªæ é€»è¾‘ ---
            const hamburger = document.querySelector('.hamburger-menu');
            const navLinks = document.querySelector('.nav-links');
            const navAuth = document.querySelector('.nav-auth');
            hamburger.addEventListener('click', () => {
                hamburger.classList.toggle('active');
                navLinks.classList.toggle('active');
                navAuth.classList.toggle('active');
            });

            // --- ç™»å½•çŠ¶æ€æ£€æµ‹ä¸åˆ‡æ¢ ---
            const loginBtn = document.getElementById('nav-login-btn');
            const userInfoDiv = document.getElementById('nav-user-info');
            const userNameSpan = document.getElementById('nav-user-name');
            const logoutBtn = document.getElementById('logout-btn');
            const tripsEmptyMsg = document.getElementById('trips-empty-message');

            function updateAuthAndTrips() {
                const user = localStorage.getItem('loggedInUser');
                if (user) {
                    const userObj = JSON.parse(user);
                    loginBtn.style.display = 'none';
                    userInfoDiv.style.display = 'inline-block';
                    userNameSpan.textContent = userObj.fullName || userObj.email;
                    tripsEmptyMsg.textContent = "You have no trips yet. Click the '+' to add one!";
                } else {
                    loginBtn.style.display = 'inline-block';
                    userInfoDiv.style.display = 'none';
                    tripsEmptyMsg.textContent = "You haven't logged in yet. Please log in to create and view your trips.";
                }
            }
            updateAuthAndTrips();

            logoutBtn.addEventListener('click', function (e) {
                e.preventDefault();
                localStorage.removeItem('loggedInUser');
                updateAuthAndTrips(); // æ›´æ–°å¯¼èˆªæ å’Œæç¤ºä¿¡æ¯
            });

            // --- Swiper é€»è¾‘ ---
            const swiper = new Swiper('.swiper-container', {
                loop: true,
                loopedSlides: 3,
                slidesPerView: 1.5,
                spaceBetween: 10,
                centeredSlides: true,
                navigation: {
                    nextEl: '.swiper-button-next',
                    prevEl: '.swiper-button-prev',
                },
                pagination: {
                    el: '.swiper-pagination',
                    clickable: true,
                },
                 breakpoints: {
                    768: {
                        slidesPerView: 3,
                        spaceBetween: 30
                    }
                }
            });

            document.querySelectorAll('.swiper-slide').forEach(slide => {
                slide.addEventListener('click', function () {
                    const city = this.dataset.city;
                    const lat = this.dataset.lat;
                    const lon = this.dataset.lon;
                    const zoom = this.dataset.zoom;
                    const url = `detail.html?city=${encodeURIComponent(city)}&lat=${lat}&lon=${lon}&zoom=${zoom}`;
                    window.location.href = url;
                });
            });
            
            // --- å¼¹çª—å’Œè¡Œç¨‹åˆ›å»ºé€»è¾‘ ---
            const addTripBtn = document.getElementById('add-trip-btn');
            const tripModal = document.getElementById('trip-modal');
            const tripCancel = document.getElementById('trip-cancel');
            const tripConfirm = document.getElementById('trip-confirm');
            const tripCity = document.getElementById('trip-city');
            const tripDateFrom = document.getElementById('trip-date-from');
            const tripDateTo = document.getElementById('trip-date-to');
            
            addTripBtn.onclick = () => {
                const user = localStorage.getItem('loggedInUser');
                if (!user) {
                    alert('You must log in to create your own trip.');
                    return;
                }
                tripModal.style.display = 'flex';
                tripCity.value = '';
                tripDateFrom.value = '';
                tripDateTo.value = '';
            };
            tripCancel.onclick = () => {
                tripModal.style.display = 'none';
            };
            tripConfirm.onclick = () => {
                const city = tripCity.value.trim();
                const dateFrom = tripDateFrom.value;
                const dateTo = tripDateTo.value;
                if (!city || !dateFrom || !dateTo) {
                    alert('Please fill in all fields');
                    return;
                }
                if (new Date(dateFrom) > new Date(dateTo)) {
                    alert('Return date must be after departure date');
                    return;
                }
                const url = `mytrip.html?city=${encodeURIComponent(city)}&from=${dateFrom}&to=${dateTo}`;
                window.location.href = url;
            };
            tripModal.onclick = (e) => {
                if (e.target === tripModal) {
                    tripModal.style.display = 'none';
                }
            };

            // ---  æœç´¢åŠŸèƒ½é€»è¾‘  ---
            const searchInput = document.getElementById('city-search-input');
            const searchBtn = document.getElementById('city-search-btn');

            const performSearch = () => {
                const searchTerm = searchInput.value.trim().toLowerCase();
                if (!searchTerm) return; 

                let foundSlide = false;
                const slides = swiper.slides;
                for (let i = 0; i < slides.length; i++) {
                    const slide = slides[i];
                    const city = slide.dataset.city;

                    if (city && city.toLowerCase() === searchTerm) {
                        const realIndex = parseInt(slide.dataset.swiperSlideIndex, 10);
                        swiper.slideToLoop(realIndex);
                        foundSlide = true;
                        break; 
                    }
                }

                if (!foundSlide) {
                    alert('City not found in featured topics.');
                }
            };

            searchBtn.addEventListener('click', performSearch);

            searchInput.addEventListener('keydown', (event) => {
                if (event.key === 'Enter') {
                    event.preventDefault(); 
                    performSearch();
                }
            });
        });
    </script>
</body>
</html>