<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Japan Travel</title>
    <!-- 引入 Swiper 的 CSS -->
    <link rel="stylesheet" href="https://unpkg.com/swiper/swiper-bundle.min.css">
    
    <!-- 引用我们自己的外部样式表 -->
    <link rel="stylesheet" href="styleForIndex.css">
</head>
<body>

    <!-- ======== 导航栏 ======== -->
    <header class="navbar">
        <div class="container">
            <a href="#" class="logo">圆周旅迹</a>
            <div class="hamburger-menu">
                <span></span>
                <span></span>
                <span></span>
            </div>
            <nav class="nav-links">
                <a href="#hero">首页</a>
                <a href="#slider-container">目的地</a>
                <a href="#my-trips">我的行程</a>
                <a href="#site-footer">联系我们</a>
            </nav>
            
            <div class="nav-auth">
                <a href="login.html" class="login" id="nav-login-btn">Log in</a>
                <div id="nav-user-info" style="display:none;">
                    <span id="nav-user-name"></span>
                    <a href="#" id="logout-btn" style="margin-left:10px;">Log out</a>
                </div>
            </div>
        </div>
    </header>

    <!-- 英雄展示区 -->
    <section id="hero" class="hero-section">
        <div class="hero-content">
            <h1>发现世界的美丽</h1>
            <p>探索全球最令人惊叹的目的地，体验独特的文化，创造难忘的回忆。我们为您提供最优质的旅行服务。</p>
            <a href="#slider-container" class="btn-explore">开始探索</a>
        </div>
    </section>

    <!-- 主内容区 -->
    <main>
        <!-- 滑块容器 (即特色目的地) -->
        <div id="slider-container" class="container">
            <div class="section-header-interactive">
                <h2>Featured Topics</h2>
                <div class="search-container">
                    <input type="search" id="city-search-input" placeholder="Search for a city...">
                    <button id="city-search-btn" aria-label="Search">🔍</button>
                </div>
            </div>

            <div class="swiper-container">
                <div class="swiper-wrapper">
                    <!-- Slide 1: Tokyo -->
                    <div class="swiper-slide" data-city="Tokyo" data-lat="35.6895" data-lon="139.6917" data-zoom="12">
                        <img src="images/tokyo.png" alt="Tokyo">
                        <div class="slide-caption">Tokyo</div>
                    </div>
                    <!-- Slide 2: Osaka -->
                    <div class="swiper-slide" data-city="Osaka" data-lat="34.6937" data-lon="135.5023" data-zoom="12">
                        <img src="images/osaka.png" alt="Osaka">
                         <div class="slide-caption">Osaka</div>
                    </div>
                    <!-- Slide 3: Kyoto -->
                    <div class="swiper-slide" data-city="Kyoto" data-lat="35.0116" data-lon="135.7681" data-zoom="12">
                        <img src="images/kyoto.png" alt="Kyoto">
                         <div class="slide-caption">Kyoto</div>
                    </div>
                    <!-- 复制的滑块 -->
                    <div class="swiper-slide" data-city="Tokyo" data-lat="35.6895" data-lon="139.6917" data-zoom="12">
                        <img src="images/tokyo.png" alt="Tokyo">
                        <div class="slide-caption">Tokyo</div>
                    </div>
                    <div class="swiper-slide" data-city="Osaka" data-lat="34.6937" data-lon="135.5023" data-zoom="12">
                        <img src="images/osaka.png" alt="Osaka">
                         <div class="slide-caption">Osaka</div>
                    </div>
                    <div class="swiper-slide" data-city="Kyoto" data-lat="35.0116" data-lon="135.7681" data-zoom="12">
                        <img src="images/kyoto.png" alt="Kyoto">
                         <div class="slide-caption">Kyoto</div>
                    </div>
                </div>
                <div class="swiper-pagination"></div>
                <div class="swiper-button-next"></div>
                <div class="swiper-button-prev"></div>
            </div>
        </div>

        <!-- 我的行程展示区 -->
        <div id="my-trips" class="container">
            <div class="my-trips-header">
                <h2>My Trips</h2>
                <button id="add-trip-btn" title="Create a new trip">+</button>
            </div>
            <div id="my-trips-list">
                <!-- 由JavaScript创建的卡片式行程将插入这里 -->
                <p class="empty-trips-message" id="trips-empty-message">You have no trips yet. Click the '+' to add one!</p>
            </div>
        </div>
    </main>

    <!-- 页脚 -->
    <footer id="site-footer" class="site-footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-column about-us">
                    <h3>关于我们</h3>
                    <p>探索世界旅行社致力于为寻求终极优选的旅行体验、让每一次旅程都成为难忘的回忆。</p>
                </div>
                <div class="footer-column quick-links">
                    <h3>快速链接</h3>
                    <ul>
                        <li><a href="#hero">首页</a></li>
                        <li><a href="#slider-container">目的地</a></li>
                        <li><a href="#">旅行套餐</a></li>
                        <li><a href="#">旅行博客</a></li>
                        <li><a href="#">常见问题</a></li>
                    </ul>
                </div>
                <div class="footer-column contact-us">
                    <h3>联系我们</h3>
                    <ul>
                        <li>电话：400-123-4567</li>
                        <li>邮箱：info@exploreworld.com</li>
                        <li>地址：北京市朝阳区建国大道18号</li>
                    </ul>
                </div>
            </div>
            <div class="footer-bottom">
                <p>© 2025 探索世界旅行社. 保留所有权利.</p>
            </div>
        </div>
    </footer>

    <!-- 创建我的行程弹窗 (这是它应该在的位置) -->
    <div id="trip-modal">
        <div class="modal-content">
            <div class="modal-title">Create My Trip</div>
            <label>Where do you want to go?</label>
            <input id="trip-city" type="text" placeholder="Enter city">
            <label>How long do you want to go?</label>
            <div class="date-picker-group">
                <div class="date-picker-item">
                    <div class="date-label">Departure date</div>
                    <input id="trip-date-from" type="date">
                </div>
                <div class="date-picker-item">
                    <div class="date-label">Return date</div>
                    <input id="trip-date-to" type="date">
                </div>
            </div>
            <div class="modal-actions">
                <button id="trip-cancel">Cancel</button>
                <button id="trip-confirm">Confirm</button>
            </div>
        </div>
    </div>

    <!-- Swiper 和脚本 -->
    <script src="https://unpkg.com/swiper/swiper-bundle.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            // --- 导航栏逻辑 ---
            const hamburger = document.querySelector('.hamburger-menu');
            const navLinks = document.querySelector('.nav-links');
            const navAuth = document.querySelector('.nav-auth');
            hamburger.addEventListener('click', () => {
                hamburger.classList.toggle('active');
                navLinks.classList.toggle('active');
                navAuth.classList.toggle('active');
            });

            // --- 登录状态检测与切换 ---
            const loginBtn = document.getElementById('nav-login-btn');
            const userInfoDiv = document.getElementById('nav-user-info');
            const userNameSpan = document.getElementById('nav-user-name');
            const logoutBtn = document.getElementById('logout-btn');
            const tripsEmptyMsg = document.getElementById('trips-empty-message');

            function updateAuthAndTrips() {
                const user = localStorage.getItem('loggedInUser');
                if (user) {
                    const userObj = JSON.parse(user);
                    loginBtn.style.display = 'none';
                    userInfoDiv.style.display = 'inline-block';
                    userNameSpan.textContent = userObj.fullName || userObj.email;
                    tripsEmptyMsg.textContent = "You have no trips yet. Click the '+' to add one!";
                } else {
                    loginBtn.style.display = 'inline-block';
                    userInfoDiv.style.display = 'none';
                    tripsEmptyMsg.textContent = "You haven't logged in yet. Please log in to create and view your trips.";
                }
            }
            updateAuthAndTrips();

            logoutBtn.addEventListener('click', function (e) {
                e.preventDefault();
                localStorage.removeItem('loggedInUser');
                updateAuthAndTrips(); // 更新导航栏和提示信息
            });

            // --- Swiper 逻辑 ---
            const swiper = new Swiper('.swiper-container', {
                loop: true,
                loopedSlides: 3,
                slidesPerView: 1.5,
                spaceBetween: 10,
                centeredSlides: true,
                navigation: {
                    nextEl: '.swiper-button-next',
                    prevEl: '.swiper-button-prev',
                },
                pagination: {
                    el: '.swiper-pagination',
                    clickable: true,
                },
                 breakpoints: {
                    768: {
                        slidesPerView: 3,
                        spaceBetween: 30
                    }
                }
            });

            document.querySelectorAll('.swiper-slide').forEach(slide => {
                slide.addEventListener('click', function () {
                    const city = this.dataset.city;
                    const lat = this.dataset.lat;
                    const lon = this.dataset.lon;
                    const zoom = this.dataset.zoom;
                    const url = `detail.html?city=${encodeURIComponent(city)}&lat=${lat}&lon=${lon}&zoom=${zoom}`;
                    window.location.href = url;
                });
            });
            
            // --- 弹窗和行程创建逻辑 ---
            const addTripBtn = document.getElementById('add-trip-btn');
            const tripModal = document.getElementById('trip-modal');
            const tripCancel = document.getElementById('trip-cancel');
            const tripConfirm = document.getElementById('trip-confirm');
            const tripCity = document.getElementById('trip-city');
            const tripDateFrom = document.getElementById('trip-date-from');
            const tripDateTo = document.getElementById('trip-date-to');
            
            addTripBtn.onclick = () => {
                const user = localStorage.getItem('loggedInUser');
                if (!user) {
                    alert('You must log in to create your own trip.');
                    return;
                }
                tripModal.style.display = 'flex';
                tripCity.value = '';
                tripDateFrom.value = '';
                tripDateTo.value = '';
            };
            tripCancel.onclick = () => {
                tripModal.style.display = 'none';
            };
            tripConfirm.onclick = () => {
                const city = tripCity.value.trim();
                const dateFrom = tripDateFrom.value;
                const dateTo = tripDateTo.value;
                if (!city || !dateFrom || !dateTo) {
                    alert('Please fill in all fields');
                    return;
                }
                if (new Date(dateFrom) > new Date(dateTo)) {
                    alert('Return date must be after departure date');
                    return;
                }
                const url = `mytrip.html?city=${encodeURIComponent(city)}&from=${dateFrom}&to=${dateTo}`;
                window.location.href = url;
            };
            tripModal.onclick = (e) => {
                if (e.target === tripModal) {
                    tripModal.style.display = 'none';
                }
            };

            // ---  搜索功能逻辑  ---
            const searchInput = document.getElementById('city-search-input');
            const searchBtn = document.getElementById('city-search-btn');

            const performSearch = () => {
                const searchTerm = searchInput.value.trim().toLowerCase();
                if (!searchTerm) return; 

                let foundSlide = false;
                const slides = swiper.slides;
                for (let i = 0; i < slides.length; i++) {
                    const slide = slides[i];
                    const city = slide.dataset.city;

                    if (city && city.toLowerCase() === searchTerm) {
                        const realIndex = parseInt(slide.dataset.swiperSlideIndex, 10);
                        swiper.slideToLoop(realIndex);
                        foundSlide = true;
                        break; 
                    }
                }

                if (!foundSlide) {
                    alert('City not found in featured topics.');
                }
            };

            searchBtn.addEventListener('click', performSearch);

            searchInput.addEventListener('keydown', (event) => {
                if (event.key === 'Enter') {
                    event.preventDefault(); 
                    performSearch();
                }
            });
        });
    </script>
</body>
</html>